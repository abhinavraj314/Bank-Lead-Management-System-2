<div class="sources-page">
  <div class="page-header">
    <h1 class="page-title">Sources</h1>
    <button class="btn btn-primary" (click)="openCreateModal()">Create Source</button>
  </div>

  <div class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>Source Name</th>
          <th>Product</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let source of sources()">
          <td>{{ source.source_name }}</td>
          <td>{{ getProductName(source.product_id) }}</td>
          <td>
            <span class="badge" [class.badge-active]="source.status === 'active'" [class.badge-inactive]="source.status === 'inactive'">
              {{ source.status }}
            </span>
          </td>
        </tr>
        @if (sources().length === 0) {
          <tr>
            <td colspan="3" class="empty-state">No sources found.</td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- Create Modal -->
  @if (showCreateModal()) {
    <div class="modal-overlay" (click)="closeCreateModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Create Source</h2>
          <button class="btn-close" (click)="closeCreateModal()">Ã—</button>
        </div>
        <div class="modal-body">
          @if (errorMessage()) {
            <div class="error-message" style="color: #dc3545; padding: 0.5rem; margin-bottom: 1rem; background: #f8d7da; border-radius: 4px;">
              {{ errorMessage() }}
            </div>
          }

          @if (currentStep() === 1) {
            <!-- Step 1: Source Details -->
            <div class="form-group">
              <label>Source Name <span style="color: red;">*</span></label>
              <input type="text" [(ngModel)]="newSource.source_name" placeholder="e.g., Bank Website, Partner" [disabled]="isCreating()" />
            </div>
            <div class="form-group">
              <label>Product <span style="color: red;">*</span></label>
              <select [(ngModel)]="newSource.product_id" [disabled]="isCreating()">
                <option value="">Select Product</option>
                <option *ngFor="let product of products()" [value]="product.product_id">
                  {{ product.product_name }}
                </option>
              </select>
            </div>
          } @else if (currentStep() === 2) {
            <!-- Step 2: Columns -->
            <div class="form-group">
              <label style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.75rem;">
                Define Source Columns <span style="color: red;">*</span>
              </label>
              <p class="hint" style="color: #666; font-size: 0.875rem; margin-bottom: 1.25rem; line-height: 1.5;">
                These are the headers expected in your lead upload files for this source.
              </p>
              <div class="column-list">
                @for (column of newSource.columns; track $index) {
                  <div class="column-item">
                    <input 
                      type="text" 
                      [(ngModel)]="newSource.columns[$index]" 
                      placeholder="e.g., Customer Name, Email Address" 
                      [disabled]="isCreating()" 
                      class="column-input" />
                    <button 
                      type="button" 
                      class="btn btn-danger btn-sm" 
                      (click)="removeColumn($index)" 
                      [disabled]="isCreating() || newSource.columns.length === 1">
                      Remove
                    </button>
                  </div>
                }
                <button 
                  type="button" 
                  class="btn btn-secondary btn-sm" 
                  (click)="addColumn()" 
                  [disabled]="isCreating()"
                  style="margin-top: 0.5rem;">
                  + Add Column
                </button>
              </div>
            </div>
          }
        </div>
        <div class="modal-footer">
          @if (currentStep() === 2) {
            <button class="btn btn-secondary" (click)="prevStep()" [disabled]="isCreating()">Back</button>
          }
          <button class="btn btn-secondary" (click)="closeCreateModal()" [disabled]="isCreating()">Cancel</button>
          @if (currentStep() === 1) {
            <button class="btn btn-primary" (click)="nextStep()" [disabled]="isCreating()">Next</button>
          } @else if (currentStep() === 2) {
            <button class="btn btn-primary" (click)="onCreateSource()" [disabled]="isCreating()">
              {{ isCreating() ? 'Creating...' : 'Create Source' }}
            </button>
          }
        </div>
      </div>
    </div>
  }
</div>
