<div class="canonical-fields-page">
  <div class="page-header">
    <h1 class="page-title">{{ isAdmin() ? 'Canonical Fields' : 'View Canonical Fields' }}</h1>
    <button *ngIf="isAdmin()" class="btn btn-primary" (click)="openCreateModal()">
      Create Canonical Field
    </button>
  </div>

  <div class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>Field Name</th>
          <th>Display Name</th>
          <th>Type</th>
          <th>Version</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let field of fields()">
          <td>{{ field.field_name }}</td>
          <td>{{ field.display_name }}</td>
          <td>
            <span class="badge badge-type">{{ field.type }}</span>
          </td>
          <td>{{ field.version }}</td>
          <td>
            <span
              class="badge"
              [class.badge-active]="field.status === 'Active'"
              [class.badge-inactive]="field.status === 'Inactive'"
            >
              {{ field.status }}
            </span>
          </td>
        </tr>
        @if (fields().length === 0) {
          <tr>
            <td colspan="5" class="empty-state">No canonical fields found.</td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- Create Modal -->
  @if (showCreateModal()) {
    <div class="modal-overlay" (click)="closeCreateModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Create Canonical Field</h2>
          <button class="btn-close" (click)="closeCreateModal()">Ã—</button>
        </div>
        <div class="modal-body">
          @if (errorMessage()) {
            <div
              class="error-message"
              style="
                color: #dc3545;
                padding: 0.5rem;
                margin-bottom: 1rem;
                background: #f8d7da;
                border-radius: 4px;
              "
            >
              {{ errorMessage() }}
            </div>
          }
          <div class="form-group">
            <label>Field Name <span style="color: red">*</span></label>
            <input
              type="text"
              [(ngModel)]="newField.field_name"
              placeholder="e.g., name, email"
              [disabled]="isCreating()"
            />
          </div>
          <div class="form-group">
            <label>Display Name <span style="color: red">*</span></label>
            <input
              type="text"
              [(ngModel)]="newField.display_name"
              placeholder="e.g., Full Name"
              [disabled]="isCreating()"
            />
          </div>
          <div class="form-group">
            <label>Type <span style="color: red">*</span></label>
            <select [(ngModel)]="newField.type" [disabled]="isCreating()">
              <option value="String">String</option>
              <option value="Number">Number</option>
              <option value="Date">Date</option>
              <option value="Boolean">Boolean</option>
            </select>
          </div>
          <div class="form-group">
            <label>Status</label>
            <select [(ngModel)]="newField.status" [disabled]="isCreating()">
              <option value="Active">Active</option>
              <option value="Inactive">Inactive</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="closeCreateModal()" [disabled]="isCreating()">
            Cancel
          </button>
          <button class="btn btn-primary" (click)="onCreateField()" [disabled]="isCreating()">
            {{ isCreating() ? 'Creating...' : 'Create' }}
          </button>
        </div>
      </div>
    </div>
  }
</div>
